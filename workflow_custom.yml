# ============================================================
# WORKFLOW CUSTOMIZADO
# Estrutura definida pelo usuário com dependências específicas
# ============================================================
main:
    steps:
    # FASE 1: NBA data, odds-events e injury-report (8 services em paralelo)
    - phase1_initial_extraction:
        parallel:
          branches:
            # Todos os NBA services
            - nba_active_players:
                steps:
                  - call_nba_active_players:
                      call: http.get
                      args:
                        url: https://nba-active-players-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - nba_game_player_stats:
                steps:
                  - call_nba_game_player_stats:
                      call: http.get
                      args:
                        url: https://nba-game-player-stats-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - nba_games:
                steps:
                  - call_nba_games:
                      call: http.get
                      args:
                        url: https://nba-games-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - nba_season_averages_general_advanced:
                steps:
                  - call_nba_season_averages_general_advanced:
                      call: http.get
                      args:
                        url: https://nba-season-averages-general-advanced-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - nba_season_averages_general_base:
                steps:
                  - call_nba_season_averages_general_base:
                      call: http.get
                      args:
                        url: https://nba-season-averages-general-base-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - nba_team_standings:
                steps:
                  - call_nba_team_standings:
                      call: http.get
                      args:
                        url: https://nba-team-standings-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            # Odds events
            - odds_events:
                steps:
                  - call_odds_events:
                      call: http.get
                      args:
                        url: https://odds-events-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            # Injury report
            - injury_report_extractor:
                steps:
                  - call_injury_report_extractor:
                      call: http.get
                      args:
                        url: https://injury-report-extractor-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
    
    # FASE 2: odds-extract-event-ids e pdf-processor (2 em paralelo)
    - phase2_extraction_and_pdf:
        parallel:
          branches:
            - odds_extract_event_ids:
                steps:
                  - call_odds_extract_event_ids:
                      call: http.get
                      args:
                        url: https://odds-extract-event-ids-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - pdf_processor:
                steps:
                  - call_pdf_processor:
                      call: googleapis.run.v2.projects.locations.jobs.run
                      args:
                        name: projects/sigma-heuristic-469419-h3/locations/us-east1/jobs/pdf-processor
    
    # FASE 3: odds-event-odds (sequencial)
    - phase3_odds_event_odds:
        call: http.get
        args:
          url: https://odds-event-odds-yiaf5ytl5q-ue.a.run.app
          auth:
            type: OIDC
    
    # FASE 4: dbt-staging (sequencial)
    - phase4_dbt_staging:
        call: googleapis.run.v2.projects.locations.jobs.run
        args:
          name: projects/sigma-heuristic-469419-h3/locations/us-east1/jobs/dbt-staging
    
    # FASE 5: depara-nba-injury-players e depara-nba-odds-players (2 em paralelo)
    - phase5_depara:
        parallel:
          branches:
            - depara_nba_injury_players:
                steps:
                  - call_depara_nba_injury_players:
                      call: http.get
                      args:
                        url: https://depara-nba-injury-players-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
            - depara_nba_odds_players:
                steps:
                  - call_depara_nba_odds_players:
                      call: http.get
                      args:
                        url: https://depara-nba-odds-players-yiaf5ytl5q-ue.a.run.app
                        auth:
                          type: OIDC
    
    # FASE 6: dbt-intermediate-marts (sequencial)
    - phase6_dbt_intermediate_marts:
        call: googleapis.run.v2.projects.locations.jobs.run
        args:
          name: projects/sigma-heuristic-469419-h3/locations/us-east1/jobs/dbt-intermediate-marts

